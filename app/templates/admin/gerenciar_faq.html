{% extends "base.html" %}

{% block content %}
<div x-data="gerenciarFaq()">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Gestão do FAQ</h2>
    <div>
        <a href="{{ url_for('admin.gerenciar_categorias_faq') }}" class="btn btn-secondary me-2">
            <i class="bi bi-tags-fill me-2"></i>Gerir Categorias
        </a>
        <a href="{{ url_for('admin.adicionar_pergunta_faq') }}" class="btn btn-success">
            <i class="bi bi-plus-circle-fill me-2"></i>Adicionar Pergunta
        </a>
    </div>
  </div>

  <div class="card">
    <div class="card-header fw-bold">
      <input type="text" x-model="search" class="form-control" placeholder="Buscar perguntas por título, resposta ou palavra-chave...">
    </div>
    <div class="card-body">
      <div class="table-responsive" style="max-height: 65vh; overflow-y: auto;">
        <ul class="list-group list-group-flush">
            <template x-for="pergunta in filteredPerguntas" :key="pergunta.id">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="my-0" x-text="pergunta.pergunta"></h6>
                        <small class="text-muted" x-text="`Categoria: ${pergunta.categoria_nome}`"></small>
                    </div>
                    <div>
                        <a :href="`/admin/faq/perguntas/editar/${pergunta.id}`" class="btn btn-sm btn-outline-secondary me-1">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <button type="button" @click="abrirModalConfirmacao(pergunta)" class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </li>
            </template>
            <template x-if="filteredPerguntas.length === 0">
                <li class="list-group-item text-center text-muted">Nenhuma pergunta encontrada para a busca.</li>
            </template>
        </ul>
      </div>
    </div>
    <div class="card-footer">
        <span class="text-muted small" x-text="`Exibindo ${filteredPerguntas.length} de ${perguntas.length} registros`"></span>
    </div>
  </div>

  <div class="modal fade" id="confirmacaoModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar Remoção</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Tem a certeza de que deseja remover a pergunta: "<strong x-text="perguntaParaRemover.pergunta"></strong>"?</p>
                <p class="text-danger small">Esta ação não pode ser desfeita.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" @click="removerPergunta()" class="btn btn-danger">Confirmar Remoção</button>
            </div>
        </div>
    </div>
  </div>

</div>
{% endblock %}

{% block page_scripts %}
<script>
    window._perguntasData = {{ perguntas|tojson|safe }};
</script>
<script src="{{ url_for('static', filename='js/gerenciarFaq.js') }}"></script>
{% endblock %}