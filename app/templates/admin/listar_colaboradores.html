{% extends "base.html" %} {% block content %}
<div x-data="colaboradoresFiltro()">
  
  <div class="row mb-4 align-items-center">
    <div class="col-lg-7">
        <div style="position: relative; min-height: 70px;" class="d-flex align-items-center">
            <img src="{{ url_for('static', filename='img/logo_nova.png') }}" alt="Intranet Auvo" 
                 style="position: absolute; top: 50%; left: 0; transform: translateY(-50%); width: 185px; height: auto;">
            <div class="totalizador-pill" style="margin-left: 205px;">
                <span>Já somos </span>
                <span class="mx-1 fw-bold">{{ total_colaboradores or 0 }}</span>
                <span>Auvolovers</span>
                <i class="bi bi-heart-fill ms-2" style="color: var(--auvo-lilas);"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card card-link-externo card-instagram h-100">
            <div class="card-body d-flex justify-content-between align-items-center p-3">
                <div>
                    <h6 class="card-title mb-1"><i class="bi bi-instagram"></i> Siga o Auvo Talentos</h6>
                    <p class="card-text small text-muted mb-0">Acompanhe nossa cultura, iniciativas e o dia a dia do time Auvo.</p>
                </div>
                <a href="https://www.instagram.com/auvotalentos/" target="_blank" class="btn btn-sm btn-instagram">@auvotalentos</a>
            </div>
        </div>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Gestão de Colaboradores</h2>
    <div>
        <a href="{{ url_for('admin.importar_colaboradores_form') }}" class="btn btn-success me-2">
            <i class="bi bi-file-earmark-spreadsheet-fill me-2"></i>Importar Planilha
        </a>
        <a href="{{ url_for('admin.adicionar_colaborador_manual_form') }}" class="btn btn-success">
            <i class="bi bi-person-plus-fill me-2"></i>Adicionar Manualmente
        </a>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <h4>
        Total de Colaboradores:
        <span
          class="badge bg-primary"
          x-text="filteredColaboradores.length"
        ></span>
      </h4>
    </div>
    <div class="col-md-6">
      <input
        type="text"
        x-model="search"
        class="form-control"
        placeholder="Buscar por nome ou e-mail..."
      />
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome Completo</th>
            <th>E-mail</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="col in filteredColaboradores" :key="col.id">
            <tr>
              <td x-text="col.id"></td>
              <td x-text="`${col.nome} ${col.sobrenome}`"></td>
              <td x-text="col.email_corporativo"></td>
              <td>
                <a
                  :href="`/admin/colaboradores/editar/${col.id}`"
                  class="btn btn-sm btn-secondary"
                  >Editar</a
                >
                <a
                  :href="`/admin/colaboradores/remover/${col.id}`"
                  class="btn btn-sm btn-danger"
                  >Remover</a
                >
              </td>
            </tr>
          </template>
          <template x-if="filteredColaboradores.length === 0">
            <tr>
              <td colspan="4" class="text-center">
                Nenhum colaborador encontrado.
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  function colaboradoresFiltro() {
      return {
          search: '',
          // O filtro 'tojson' e 'safe' garantem que os dados do Python cheguem corretamente
          colaboradores: {{ colaboradores|tojson|safe }},
          get filteredColaboradores() {
              if (this.search.trim() === '') {
                  return this.colaboradores;
              }
              const searchTerm = this.search.toLowerCase();
              return this.colaboradores.filter(
                  col => {
                      const nomeCompleto = `${col.nome} ${col.sobrenome}`.toLowerCase();
                      const email = col.email_corporativo.toLowerCase();
                      return nomeCompleto.includes(searchTerm) || email.includes(searchTerm);
                  }
              );
          }
      }
  }
</script>
{% endblock %}