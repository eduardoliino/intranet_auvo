<!DOCTYPE html>
<html lang="pt-br" class="h-100">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Intranet Auvo</title>
    
    <link rel="icon" href="{{ url_for('static', filename='img/logo_icon.svg') }}" type="image/svg+xml">

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body>
    <div 
        x-data="toastHandler()" 
        class="position-fixed top-0 end-0 p-3" 
        style="z-index: 1100"
        @toast.window="addToast($event.detail)"
    >
        <template x-for="toast in toasts" :key="toast.id">
            <div 
                class="toast show mb-2" 
                role="alert" 
                aria-live="assertive" 
                aria-atomic="true"
                x-show="toast.visible"
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 transform translate-x-8"
                x-transition:enter-end="opacity-100 transform translate-x-0"
                x-transition:leave="transition ease-in duration-300"
                x-transition:leave-start="opacity-100"
                x-transition:leave-end="opacity-0"
            >
                <div class="toast-header" :class="{
                    'bg-success text-white': toast.type === 'success',
                    'bg-danger text-white': toast.type === 'danger',
                    'bg-warning text-dark': toast.type === 'warning',
                    'bg-info text-white': toast.type === 'info'
                }">
                    <strong class="me-auto" x-text="toast.title"></strong>
                    <button type="button" class="btn-close btn-close-white" @click="removeToast(toast.id)"></button>
                </div>
                <div class="toast-body" x-text="toast.message"></div>
            </div>
        </template>
    </div>

    <div class="d-flex">
        <nav class="sidebar">
            <div class="sidebar-header" style="height: 60px;">
                </div>
            <ul class="list-unstyled components">
                <li class="{{ 'active' if request.endpoint == 'main.index' else '' }}">
                    <a href="{{ url_for('main.index') }}"><i class="bi bi-house-door-fill"></i> Início</a>
                </li>
                
                <li class="{{ 'active' if request.endpoint == 'main.ouvidoria' else '' }}">
                    <a href="{{ url_for('main.ouvidoria') }}"><i class="bi bi-ear-fill"></i> Ouvidoria</a>
                </li>
                <li class="{{ 'active' if request.endpoint == 'main.faq_publico' else '' }}">
                    <a href="{{ url_for('main.faq_publico') }}"><i class="bi bi-patch-question-fill"></i> FAQ</a>
                </li>

                <hr class="sidebar-divider" />

                {% if current_user.is_authenticated %}
                    {% if current_user.is_admin %}
                    <li class="{{ 'active' if 'colaborador' in request.endpoint else '' }}">
                        <a href="{{ url_for('admin.listar_colaboradores') }}"><i class="bi bi-people-fill"></i> Gerir Colaboradores</a>
                    </li>
                    <li class="{{ 'active' if 'aviso' in request.endpoint else '' }}">
                        <a href="{{ url_for('admin.gerenciar_avisos') }}"><i class="bi bi-megaphone-fill"></i> Gerir Avisos</a>
                    </li>
                    <li class="{{ 'active' if 'destaque' in request.endpoint else '' }}">
                        <a href="{{ url_for('admin.gerenciar_destaques') }}"><i class="bi bi-star-fill"></i> Gerir Destaques</a>
                    </li>
                    <li class="{{ 'active' if 'faq' in request.endpoint else '' }}">
                        <a href="{{ url_for('admin.gerenciar_faq') }}"><i class="bi bi-patch-question-fill"></i> Gerir FAQ</a>
                    </li>
                    <li class="{{ 'active' if 'ouvidoria' in request.endpoint else '' }}">
                        <a href="{{ url_for('admin.gerenciar_ouvidoria') }}"><i class="bi bi-ear-fill"></i> Gerir Ouvidoria</a>
                    </li>
                     <li class="{{ 'active' if 'evento' in request.endpoint else '' }}">
                        <a href="{{ url_for('admin.gerenciar_eventos') }}"><i class="bi bi-calendar-event-fill"></i> Gerir Eventos</a>
                    </li>
                    {% endif %}

                    <hr class="sidebar-divider" />
                    
                    <li>
                        <a href="{{ url_for('auth.logout') }}" data-bs-toggle="tooltip" data-bs-placement="right" title="Sair do sistema">
                            <i class="bi bi-box-arrow-right"></i> Sair
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>

        <div id="content" class="p-4 p-md-5">
            {% block content %}{% endblock %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/pt-br.js"></script>
    
    {% block page_scripts %}{% endblock %}

    <script>
        function toastHandler() {
            return {
                toasts: [],
                counter: 0,
                addToast(toast) {
                    const id = this.counter++;
                    const titles = {
                        success: 'Sucesso!',
                        danger: 'Erro!',
                        warning: 'Atenção!',
                        info: 'Informação'
                    };
                    this.toasts.push({
                        id: id,
                        type: toast.type || 'info',
                        title: titles[toast.type] || 'Notificação',
                        message: toast.message,
                        visible: true
                    });
                    setTimeout(() => {
                        this.removeToast(id);
                    }, 5000);
                },
                removeToast(id) {
                    const toast = this.toasts.find(t => t.id === id);
                    if (toast) {
                        toast.visible = false;
                        setTimeout(() => {
                           this.toasts = this.toasts.filter(t => t.id !== id);
                        }, 400);
                    }
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            var selects = document.querySelectorAll('select.custom-select');
            selects.forEach(function(select) {
                new TomSelect(select, {});
            });

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        window.dispatchEvent(new CustomEvent('toast', { detail: { type: '{{ category }}', message: {{ message|tojson|safe }} }}));
                    {% endfor %}
                {% endif %}
            {% endwith %}

            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
        });
    </script>
</body>
</html>